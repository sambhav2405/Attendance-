<!DOCTYPE html>
<html lang="en">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4XQ0JK7ELF"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-4XQ0JK7ELF');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SKIT Academic Pro v5.0</title>
    <meta name="theme-color" content="#4f46e5">

    <link rel="icon" type="image/jpeg" href="unnamed.jpg">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --theme-color: #4f46e5; 
            --glass-bg: rgba(255, 255, 255, 0.95);
            --glass-border: rgba(255, 255, 255, 0.6);
            --text-main: #1f2937;
            --text-light: #6b7280;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: #000428;
            background-image: linear-gradient(135deg, #000428 0%, #004e92 50%, #6a11cb 100%);
            background-attachment: fixed;
            background-size: cover;
            color: var(--text-main);
            min-height: 100vh;
            margin: 0;
            padding: 20px 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* --- Glassmorphism Card --- */
        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 600px;
            padding: 25px;
            margin-bottom: 20px;
            transition: transform 0.3s ease;
        }

        h1 {
            font-size: 1.5rem;
            text-align: center;
            margin: 0 0 5px 0;
            color: var(--theme-color);
            font-weight: 700;
        }
        
        .subtitle {
            text-align: center;
            font-size: 0.85rem;
            color: var(--text-light);
            margin-bottom: 20px;
        }

        textarea {
            width: 100%;
            height: 100px;
            padding: 15px;
            border-radius: 15px;
            border: 2px solid #e5e7eb;
            font-family: monospace;
            font-size: 0.9rem;
            resize: none;
            transition: border 0.2s;
            outline: none;
        }
        
        textarea:focus { border-color: var(--theme-color); }

        .btn-main {
            width: 100%;
            padding: 14px;
            background: var(--theme-color);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.2s, background 0.2s;
            margin-top: 10px;
        }

        .btn-main:active { transform: scale(0.98); }

        /* --- Dashboard --- */
        #dashboard { display: none; animation: slideUp 0.5s ease; }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- Score Circle --- */
        .score-circle {
            position: relative;
            width: 150px;
            height: 150px;
            margin: 0 auto 20px auto;
            border-radius: 50%;
            background: conic-gradient(var(--theme-color) 0deg, #e5e7eb 0deg);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .score-circle::before {
            content: "";
            position: absolute;
            width: 120px;
            height: 120px;
            background: white;
            border-radius: 50%;
        }

        .score-val {
            position: relative;
            font-size: 2.2rem;
            font-weight: 800;
            color: var(--theme-color);
        }

        .status-badge {
            text-align: center;
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 5px;
            color: var(--theme-color);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .funny-msg {
            text-align: center;
            font-size: 0.9rem;
            font-style: italic;
            color: #555;
            margin-bottom: 20px;
            background: rgba(255,255,255,0.5);
            padding: 10px;
            border-radius: 8px;
        }

        /* --- Stats Grid --- */
        .stats-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-item {
            background: #f9fafb;
            padding: 10px;
            border-radius: 12px;
            text-align: center;
        }
        .stat-val { font-weight: 700; font-size: 1.1rem; color: #333; }
        .stat-label { font-size: 0.8rem; color: #777; }

        /* --- Collapsible Buttons --- */
        .toggle-btn {
            width: 100%;
            background: linear-gradient(to right, #f3f4f6, #fff);
            border: 1px solid #e5e7eb;
            padding: 14px;
            border-radius: 12px;
            font-weight: 600;
            color: #333;
            text-align: left;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            margin-bottom: 12px;
            transition: all 0.2s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.03);
        }
        .toggle-btn:hover { transform: translateY(-2px); }
        .toggle-btn.active { border-left: 4px solid var(--theme-color); background: #f8fafc; }
        .toggle-btn i.fa-chevron-down { transition: transform 0.3s; }
        .toggle-btn.active i.fa-chevron-down { transform: rotate(180deg); }

        .collapsible-content {
            display: none;
            padding: 5px 0;
            animation: slideDown 0.3s ease forwards;
        }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- Time Travel Grid --- */
        .schedule-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr); 
            gap: 10px;
            margin-bottom: 15px;
            width: 100%;
        }
        .day-input { text-align: center; }
        .day-input label { 
            display: block; 
            font-size: 0.7rem; 
            color: #666; 
            margin-bottom: 4px; 
            text-transform: uppercase;
            font-weight: 600;
        }
        .day-input input {
            width: 100%; 
            padding: 10px 0; 
            border: 1px solid #ddd; 
            border-radius: 10px;
            text-align: center; 
            font-weight: bold; 
            font-size: 1rem;
            background: #fff;
            color: #333;
            transition: border-color 0.2s;
        }
        .day-input input:focus { border-color: var(--theme-color); outline: none; background: #f0f9ff; }

        /* --- Subject Cards --- */
        .sub-card {
            background: white;
            padding: 15px;
            border-radius: 14px;
            margin-bottom: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.04);
            border: 1px solid #f0f0f0;
            border-left: 5px solid #ccc;
        }
        
        .sub-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }
        
        .sub-name { 
            font-weight: 700; font-size: 0.9rem; color: #333; 
            flex: 1; padding-right: 10px; word-wrap: break-word; 
        }
        
        .sub-percent { font-weight: 800; font-size: 1rem; white-space: nowrap; }
        
        .progress-track {
            width: 100%; height: 8px; background: #e5e7eb; border-radius: 10px; overflow: hidden; margin-bottom: 8px;
        }
        .progress-fill { height: 100%; border-radius: 10px; transition: width 1s ease-in-out; }
        
        .sub-msg { font-size: 0.75rem; font-weight: 600; padding: 4px 8px; border-radius: 4px; display: inline-block; }
        .msg-danger { background: #fee2e2; color: #dc2626; }
        .msg-safe { background: #dcfce7; color: #166534; }


        /* --- Tools Section --- */
        .tool-header {
            font-size: 0.95rem; font-weight: 600; margin: 15px 0 10px 0;
            display: flex; align-items: center; gap: 8px;
        }
        .tool-row { display: flex; gap: 10px; margin-bottom: 5px; }

        input[type="number"] {
            width: 70px; padding: 10px; border: 1px solid #ddd;
            border-radius: 8px; text-align: center; font-weight: bold;
        }

        .btn-action {
            flex: 1; padding: 10px; border: none; border-radius: 8px;
            background: #eef2ff; color: var(--theme-color); font-weight: 600;
            font-size: 0.9rem; cursor: pointer;
        }
        
        .result-text { font-size: 0.85rem; color: #666; margin-bottom: 15px; margin-left: 2px; }

        .btn-share {
            background: #25D366; color: white; width: 100%; margin-top: 20px;
            padding: 12px; border-radius: 50px; display: flex;
            align-items: center; justify-content: center; gap: 10px;
            font-weight: 600; border: none; cursor: pointer;
            box-shadow: 0 4px 12px rgba(37, 211, 102, 0.3);
        }

        .qr-container {
            margin-top: 15px; background: white; padding: 10px;
            border-radius: 10px; display: inline-block;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        /* --- CGPA CALCULATOR STYLES --- */
        .divider {
            display: flex; align-items: center; text-align: center;
            margin: 25px 0 15px 0; color: #aaa; font-size: 0.8rem;
            font-weight: 600; letter-spacing: 1px;
        }
        .divider::before, .divider::after {
            content: ''; flex: 1; border-bottom: 1px solid #e5e7eb;
        }
        .divider span { padding: 0 10px; }

        .cgpa-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .cgpa-card {
            background: white; border: 2px solid transparent; padding: 15px 10px;
            border-radius: 12px; text-align: center; text-decoration: none;
            color: var(--text-main); transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05); display: flex;
            flex-direction: column; align-items: center; gap: 8px;
        }
        .cgpa-card:hover {
            transform: translateY(-3px); border-color: var(--theme-color);
            box-shadow: 0 5px 15px rgba(79, 70, 229, 0.15);
        }
        .cgpa-icon { font-size: 1.5rem; color: var(--theme-color); }
        .cgpa-label { font-size: 0.85rem; font-weight: 700; }
        .cgpa-sub { font-size: 0.7rem; color: #888; }

        /* --- Helper Classes --- */
        .color-elite { --theme-color: #059669; }
        .color-safe { --theme-color: #0ea5e9; }
        .color-risky { --theme-color: #f59e0b; }
        .color-danger { --theme-color: #ea580c; }
        .color-critical { --theme-color: #dc2626; }

        /* --- AD CONTAINER --- */
        .ad-container {
            margin-top: 20px;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100px;
            padding-bottom: 10px;
            background: rgba(255, 255, 255, 0.2); /* Subtle glass bg */
            border-radius: 12px;
            overflow: hidden;
        }

    </style>
</head>
<body>

    <div class="glass-card" id="mainContainer">
        <h1>SKIT Academic Pro <span style="font-size:0.5em; vertical-align:super;">v5.0</span></h1>
        <p class="subtitle">Attendance & CGPA Manager</p>

        <div id="inputSection">
            <p style="font-size: 0.9rem; color: #555; margin-bottom: 8px;">
                <i class="fas fa-clipboard"></i> Paste Full Attendance Report:
            </p>
            <textarea id="inputData" placeholder="Copy table from ERP and paste here..."></textarea>
            <button class="btn-main" onclick="processReport()">Calculate Attendance üöÄ</button>
            <div style="text-align:center; margin-top:10px;">
                 <a href="https://erp.skit.ac.in/reports/student_aggregate" 
                   style="display: inline-block; background-color: #EEF2FF; color: #4F46E5; font-weight: 600; font-size: 0.85rem; text-decoration: none; padding: 8px 16px; border-radius: 50px; box-shadow: 0 2px 4px rgba(79, 70, 229, 0.1); border: 1px solid #E0E7FF; margin-top: 12px; font-family: sans-serif;">
                   Where do I copy from? ü§î
                </a>
            </div>

            <div class="divider"><span>OR CALCULATE CGPA</span></div>
            <div class="cgpa-grid">
                <a href="https://cgpa-1sem.netlify.app/" target="_blank" class="cgpa-card">
                    <i class="fas fa-baby cgpa-icon"></i>
                    <span class="cgpa-label">1st Sem</span>
                    <span class="cgpa-sub">Fresher Calculator</span>
                </a>
                <a href="https://bestcgpa.netlify.app/" target="_blank" class="cgpa-card">
                    <i class="fas fa-user-graduate cgpa-icon"></i>
                    <span class="cgpa-label">3rd Sem</span>
                    <span class="cgpa-sub">Senior Calculator</span>
                </a>
            </div>
        </div>

        <div id="dashboard">
            <div class="status-badge" id="statusBadge">Checking...</div>
            
            <div class="score-circle">
                <span class="score-val" id="percentDisplay">0%</span>
            </div>

            <div class="funny-msg" id="funnyMsg">"Calculating..."</div>

            <div class="stats-row">
                <div class="stat-item">
                    <div class="stat-val" id="attendedVal">0</div>
                    <div class="stat-label">Attended</div>
                </div>
                <div class="stat-item">
                    <div class="stat-val" id="totalVal">0</div>
                    <div class="stat-label">Total Held</div>
                </div>
            </div>

            <hr style="border: 0; border-top: 1px solid #eee; margin: 20px 0;">

            <button class="toggle-btn" onclick="toggleSection('timeTravel', this)">
                <span><i class="fas fa-calendar-alt" style="margin-right:8px; color:#6a11cb;"></i> <b>75% Prediction Date</b></span>
                <i class="fas fa-chevron-down"></i>
            </button>
            <div id="timeTravel" class="collapsible-content">
                <p style="font-size:0.75rem; color:#555; margin-bottom:10px;">Edit daily classes (Sun & Holidays are off):</p>
                <div class="schedule-grid">
                    <div class="day-input"><label>Mon</label><input type="number" id="sch_mon" value="5" oninput="liveUpdateDate()"></div>
                    <div class="day-input"><label>Tue</label><input type="number" id="sch_tue" value="5" oninput="liveUpdateDate()"></div>
                    <div class="day-input"><label>Wed</label><input type="number" id="sch_wed" value="5" oninput="liveUpdateDate()"></div>
                    <div class="day-input"><label>Thu</label><input type="number" id="sch_thu" value="6" oninput="liveUpdateDate()"></div>
                    <div class="day-input"><label>Fri</label><input type="number" id="sch_fri" value="5" oninput="liveUpdateDate()"></div>
                    <div class="day-input"><label>Sat</label><input type="number" id="sch_sat" value="5" oninput="liveUpdateDate()"></div>
                </div>
                <button class="btn-action" style="width:100%; background: #6a11cb; color:white; margin-bottom:10px;" onclick="calculateDate()">
                    üìÖ When will I reach 75%?
                </button>
                <div id="dateResult" class="result-text" style="background:#f3f4f6; padding:10px; border-radius:8px; display:none; border-left: 4px solid #6a11cb;"></div>
            </div>

            <button class="toggle-btn" onclick="toggleSection('subjectList', this)">
                <span><i class="fas fa-list-ul" style="margin-right:8px;"></i> Subject Breakdown</span>
                <i class="fas fa-chevron-down"></i>
            </button>
            <div id="subjectList" class="collapsible-content">
            </div>

            <div class="tool-header" style="color: #2563EB;">
                <i class="fas fa-plus-circle"></i> Attend Future Classes
            </div>
            <div class="tool-row">
                <input type="number" id="futureInput" placeholder="classes">
                <button class="btn-action" style="background:#eff6ff; color:#2563EB;" onclick="checkFuture()">Check Boost üöÄ</button>
            </div>
            <div id="futureResult" class="result-text"></div>

            <div class="tool-header" style="color: #f59e0b;">
                <i class="fas fa-bed"></i> Can I Bunk?
            </div>
            <div class="tool-row">
                <input type="number" id="bunkInput" placeholder="classes">
                <button class="btn-action" style="background:#fffbeb; color:#f59e0b;" onclick="checkBunk()">Check Drop üìâ</button>
            </div>
            <div id="bunkResult" class="result-text"></div>

            <div class="tool-header" style="color: #059669;">
                <i class="fas fa-bullseye"></i> Reach Target
            </div>
            <div class="tool-row">
                <input type="number" id="targetInput" placeholder="%">
                <button class="btn-action" style="background:#ecfdf5; color:#059669;" onclick="calcTarget()">Classes Needed üìà</button>
            </div>
            <div id="targetResult" class="result-text"></div>

            <div class="tool-header" style="color: #db2777;">
                <i class="fas fa-file-signature"></i> Add OD(On Duty)
            </div>
            <div class="tool-row">
                <input type="number" id="odInput" placeholder="classes">
                <button class="btn-action" style="background:#fce7f3; color:#db2777;" onclick="checkOD()">Check Impact üè•</button>
            </div>
            <div id="odResult" class="result-text"></div>


            <div class="tool-header" style="color: #6a11cb; margin-top: 25px;">
                <i class="fas fa-calculator"></i> Check Your Grades
            </div>
            <div class="cgpa-grid" style="margin-bottom: 20px;">
                <a href="https://cgpa-1sem.netlify.app/" target="_blank" class="cgpa-card" style="padding: 10px; flex-direction: row; justify-content: center;">
                    <i class="fas fa-baby"></i> 1st Sem
                </a>
                <a href="https://bestcgpa.netlify.app/" target="_blank" class="cgpa-card" style="padding: 10px; flex-direction: row; justify-content: center;">
                    <i class="fas fa-user-graduate"></i> 3rd Sem
                </a>
            </div>

            <button class="btn-share" onclick="shareResult()">
                <i class="fab fa-whatsapp"></i> Share Status
            </button>
            
            <button style="background:transparent; border:none; color:#666; width:100%; margin-top:15px; font-size:0.8rem; text-decoration:underline;" onclick="resetApp()">
                Check Another
            </button>
        </div>
    </div>

    <div class="glass-card" style="text-align: center; padding: 20px;">
        <p style="margin: 0; font-weight: 600; font-size: 0.9rem;">Enjoying the Safe Bunks?</p>
        <p style="font-size: 0.8rem; color: #666; margin-bottom: 15px;">Support the Developer ‚òï</p>
        
        <div class="qr-container">
            <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=upi://pay?pa=jainsambhav877@oksbi&pn=Sambhav&cu=INR" 
                 alt="Scan to Pay" width="150" height="150">
        </div>
        
        <br><br>
        <a href="upi://pay?pa=jainsambhav877@oksbi&pn=Sambhav&cu=INR" 
           style="background:#2563EB; color:white; padding:10px 24px; border-radius:30px; text-decoration:none; font-size:0.9rem; font-weight:600; display:inline-block; box-shadow: 0 4px 10px rgba(37,99,235,0.3);">
           Pay via UPI App
        </a>
    </div>

    <div class="ad-container">
        <script async="async" data-cfasync="false" src="https://pl28592186.effectivegatecpm.com/87307e4ec90977b7ebc2bd28dde49abe/invoke.js"></script>
        <div id="container-87307e4ec90977b7ebc2bd28dde49abe"></div>
    </div>
    <script>
        // Global Variables
        let g_present = 0;
        let g_total = 0;
        let g_percent = 0;
        let g_subjects = [];

        // On Load
        window.addEventListener('load', () => {
            const saved = localStorage.getItem('skit_data_v4_2');
            if(saved) {
                document.getElementById('inputData').value = saved;
            }
        });

        function toggleSection(id, btn) {
            const el = document.getElementById(id);
            if (el.style.display === "block") {
                el.style.display = "none";
                btn.classList.remove("active");
            } else {
                el.style.display = "block";
                btn.classList.add("active");
            }
        }

        function resetApp() {
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('inputSection').style.display = 'block';
            document.getElementById('inputData').value = "";
            localStorage.removeItem('skit_data_v4_2');
            
            // Clear inputs
            ['futureInput', 'bunkInput', 'targetInput', 'odInput'].forEach(id => {
                document.getElementById(id).value = "";
            });
            ['futureResult', 'bunkResult', 'targetResult', 'odResult'].forEach(id => {
                document.getElementById(id).innerText = "";
            });
            
            g_subjects = [];
        }

        function processReport() {
            const text = document.getElementById('inputData').value;
            const lines = text.split('\n');
            
            g_present = 0;
            g_total = 0;
            g_subjects = [];
            let found = false;
            
            // Regex to capture Subject Name + Numbers
            const regex = /^(.*?)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+([0-9.]+)$/;

            lines.forEach(line => {
                const match = line.trim().match(regex);
                if (match) {
                    found = true;
                    // Extract data
                    const rawName = match[1].replace(/^\d+\s+/, '').trim(); // Remove leading numbers
                    const attended = parseInt(match[2]) + parseInt(match[3]) + parseInt(match[4]);
                    const absent = parseInt(match[5]);
                    const total = attended + absent;
                    
                    if(total > 0) {
                        g_present += attended;
                        g_total += total;
                        
                        g_subjects.push({
                            name: rawName,
                            attended: attended,
                            total: total,
                            percent: ((attended / total) * 100).toFixed(2)
                        });
                    }
                }
            });

            if (!found) {
                alert("‚ùå Data not found! Please copy the full table from SKIT ERP.");
                return;
            }

            localStorage.setItem('skit_data_v4_2', text);
            g_percent = ((g_present / g_total) * 100).toFixed(2);

            updateDashboard();
        }

        function updateDashboard() {
            const mainCard = document.getElementById('mainContainer');
            const statusBadge = document.getElementById('statusBadge');
            const funnyMsg = document.getElementById('funnyMsg');
            
            document.getElementById('attendedVal').innerText = g_present;
            document.getElementById('totalVal').innerText = g_total;
            animateCircle(parseFloat(g_percent));

            let msg = "";
            let themeClass = "";
            let badgeText = "";
            const p = parseFloat(g_percent);

            mainCard.classList.remove('color-elite', 'color-safe', 'color-risky', 'color-danger', 'color-critical');

            if (p >= 85) {
                themeClass = "color-elite";
                badgeText = "üëë ELITE STUDENT";
                msg = "Attendance itni high ki HOD bhi autograph maange. Nerd Alert! ü§ì";
            } else if (p >= 75) {
                themeClass = "color-safe";
                badgeText = "üòé SAFE ZONE";
                msg = "Perfect balance. Life set hai, bas maintain rakhna bhai. ‚ú®";
            } else if (p >= 65) {
                themeClass = "color-risky";
                badgeText = "‚ö†Ô∏è WARNING ZONE";
                msg = "Living on the edge? Ek-do bunk aur game over. Sambhal ja! üõë";
            } else if (p >= 45) {
                themeClass = "color-danger";
                badgeText = "üî• DANGER ZONE";
                msg = "HOD Room loading... Mummy ko call aane wala hai. Prayers sent. üôè";
            } else {
                themeClass = "color-critical";
                badgeText = "üíÄ LEGENDARY";
                msg = "College is temporary, Backlogs are permanent. Next sem phodenge! üóø";
            }

            mainCard.classList.add(themeClass);
            statusBadge.innerText = badgeText;
            funnyMsg.innerText = `"${msg}"`;

            // Render Subjects
            renderSubjects();

            document.getElementById('inputSection').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
        }

        function renderSubjects() {
            const list = document.getElementById('subjectList');
            list.innerHTML = "";
            
            g_subjects.forEach(sub => {
                let color = "#4f46e5"; 
                let msgHtml = "";
                let p = parseFloat(sub.percent);
                let reqClasses = 0;

                // LOGIC: Calculate classes needed for 75%
                if(p < 75) {
                    color = "#dc2626"; // Red
                    // Formula: (Present + x) / (Total + x) = 0.75
                    reqClasses = Math.ceil((0.75 * sub.total - sub.attended) / 0.25);
                    msgHtml = `<div class="sub-msg msg-danger">‚ö†Ô∏è Attend <b>${reqClasses}</b> more classes for 75%</div>`;
                } else {
                    color = "#059669"; // Green
                    // Formula for Safe Bunks: (Present) / (Total + x) = 0.75
                    let bunks = Math.floor((sub.attended / 0.75) - sub.total);
                    if (bunks > 0) msgHtml = `<div class="sub-msg msg-safe">‚úÖ Safe to bunk <b>${bunks}</b> classes</div>`;
                    else msgHtml = `<div class="sub-msg" style="background:#f3f4f6; color:#555">Exact 75% or near. Don't bunk!</div>`;
                }

                list.innerHTML += `
                    <div class="sub-card" style="border-left-color:${color}">
                        <div class="sub-header">
                            <span class="sub-name">${sub.name}</span>
                            <span class="sub-percent" style="color:${color}">${sub.percent}%</span>
                        </div>
                        <div class="progress-track">
                            <div class="progress-fill" style="width:${sub.percent}%; background:${color};"></div>
                        </div>
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <span style="font-size:0.75rem; color:#666;">${sub.attended}/${sub.total}</span>
                            ${msgHtml}
                        </div>
                    </div>
                `;
            });
        }

        // --- NEW TIME TRAVEL LOGIC (SIMPLE SUNDAY SKIP) ---
        // Helper to update date on typing without clicking button
        function liveUpdateDate() {
            const resultBox = document.getElementById('dateResult');
            // Only update if the user has already revealed the date section
            if(resultBox.style.display === 'block') {
                calculateDate();
            }
        }

        function calculateDate() {
            if(parseFloat(g_percent) >= 75) {
                document.getElementById('dateResult').style.display = 'block';
                document.getElementById('dateResult').innerHTML = "<b>Relax!</b> You are already above 75%. <br>Enjoy your life! üòé";
                return;
            }

            // Holidays for 2026
            const holidays = [
                "2026-02-15", // Mahashivratri
                "2026-03-02", "2026-03-03", // Holi
                "2026-03-26", // Ram Navmi
                "2026-08-15", // Independence Day
                "2026-08-28", // Raksha Bandhan
                "2026-09-04", // Janmashtami
                "2026-10-20"  // Dussehra
            ];
            
            // Function to check if a date is a holiday or Sunday
            function isHolidayOrSunday(date) {
                if (date.getDay() === 0) return true; // Sunday

                // Check Specific Holidays
                const dStr = date.toISOString().split('T')[0];
                if (holidays.includes(dStr)) return true;

                // Autumn Break: 6 to 15 Nov
                const autumnStart = new Date("2026-11-06");
                const autumnEnd = new Date("2026-11-15");
                if (date >= autumnStart && date <= autumnEnd) return true;

                // Winter Break: 25 to 31 Dec
                const winterStart = new Date("2026-12-25");
                const winterEnd = new Date("2026-12-31");
                if (date >= winterStart && date <= winterEnd) return true;

                return false;
            }

            // 1. Get Weekly Schedule from Inputs
            const schedule = [
                0, // Sunday
                parseInt(document.getElementById('sch_mon').value) || 0,
                parseInt(document.getElementById('sch_tue').value) || 0,
                parseInt(document.getElementById('sch_wed').value) || 0,
                parseInt(document.getElementById('sch_thu').value) || 0,
                parseInt(document.getElementById('sch_fri').value) || 0,
                parseInt(document.getElementById('sch_sat').value) || 0
            ];

            // 2. Calculate Total Classes Needed
            let needed = Math.ceil((0.75 * g_total - g_present) / 0.25);
            let daysPassed = 0;
            let currentDate = new Date(); 

            // 3. Loop days
            while (needed > 0) {
                currentDate.setDate(currentDate.getDate() + 1);
                daysPassed++;
                
                if (isHolidayOrSunday(currentDate)) continue; // Skip holidays

                let dayIndex = currentDate.getDay(); 
                let classesToday = schedule[dayIndex];
                needed -= classesToday;

                if(daysPassed > 365) {
                    document.getElementById('dateResult').style.display = 'block';
                    document.getElementById('dateResult').innerHTML = "‚ö†Ô∏è Schedule is empty or target too far.";
                    return;
                }
            }

            // 4. Show Result
            const options = { weekday: 'long', year: 'numeric', month: 'short', day: 'numeric' };
            const dateString = currentDate.toLocaleDateString('en-IN', options);

            document.getElementById('dateResult').style.display = 'block';
            document.getElementById('dateResult').innerHTML = 
                `If you attend daily (excluding holidays):<br><b style="font-size:1.1rem; color:#6a11cb;">${dateString}</b><br><span style="font-size:0.8rem">(${daysPassed} days from now)</span>`;
        }

        function checkFuture() {
            const extra = parseInt(document.getElementById('futureInput').value);
            if(!extra) return;
            
            const newTotal = g_total + extra;
            const newPresent = g_present + extra;
            const newPercent = (newPresent / newTotal) * 100;
            const boost = newPercent - parseFloat(g_percent);
            
            document.getElementById('futureResult').innerHTML = 
                `New %: <b>${newPercent.toFixed(2)}%</b> <span style="color:var(--theme-color)">(+${boost.toFixed(2)}%)</span>`;
        }

        function checkBunk() {
            const bunk = parseInt(document.getElementById('bunkInput').value);
            if(!bunk) return;
            
            const newTotal = g_total + bunk;
            const newPercent = (g_present / newTotal) * 100;
            const drop = parseFloat(g_percent) - newPercent;
            
            document.getElementById('bunkResult').innerHTML = 
                `New %: <b>${newPercent.toFixed(2)}%</b> <span style="color:red">(-${drop.toFixed(2)}%)</span>`;
        }

        function calcTarget() {
            const target = parseFloat(document.getElementById('targetInput').value);
            if(!target) return;
            
            const p = target / 100;
            if(p >= 1 || target <= parseFloat(g_percent)) {
                 document.getElementById('targetResult').innerText = "Target already met or invalid!";
                 return;
            }

            let required = (p * g_total - g_present) / (1 - p);
            required = Math.ceil(required);
            
            document.getElementById('targetResult').innerHTML = 
                `You need to attend <b>${required}</b> more classes continuously.`;
        }

        function checkOD() {
            const od = parseInt(document.getElementById('odInput').value);
            if(!od) return;
            
            const newPresent = g_present + od;
            const newTotal = g_total; 
            
            const newPercent = (newPresent / newTotal) * 100;
            const boost = newPercent - parseFloat(g_percent);
            
            document.getElementById('odResult').innerHTML = 
                `New %: <b>${newPercent.toFixed(2)}%</b> <span style="color:#db2777">(+${boost.toFixed(2)}%)</span>`;
        }

        function shareResult() {
            const p = parseFloat(g_percent);
            let shareText = "";

            if (p >= 85) shareText = `ü§ì My Attendance is ${p}%. I attend classes so you don't have to. #SKITTopper`;
            else if (p >= 75) shareText = `üòé My Attendance is ${p}%. Chill vibes only. Safe Zone. #SKITManager`;
            else if (p >= 65) shareText = `üíÄ My Attendance is ${p}%. Risk hai toh Ishq hai. #LivingOnEdge`;
            else if (p >= 45) shareText = `üÜò My Attendance is ${p}%. Send prayers, HOD is watching. #DangerZone`;
            else shareText = `üóø My Attendance is ${p}%. Legend status achieved. #BacklogWarrior`;

            shareText += `\n\nCheck yours here:https://magical-tanuki-6349b2.netlify.app/`;

            if (navigator.share) {
                navigator.share({
                    title: 'SKIT Academic Status',
                    text: shareText
                }).catch(console.error);
            } else {
                window.open(`https://wa.me/?text=${encodeURIComponent(shareText)}`, '_blank');
            }
        }

        function animateCircle(target) {
            const circle = document.querySelector('.score-circle');
            const text = document.getElementById('percentDisplay');

            let current = 0;
            const step = target / 60; 

            const interval = setInterval(() => {
                current += step;
                if (current >= target) {
                    current = target;
                    clearInterval(interval);
                }
                text.innerText = current.toFixed(2) + "%";
                circle.style.background = `conic-gradient(var(--theme-color) ${current * 3.6}deg, #e5e7eb ${current * 3.6}deg)`;
            }, 16); 
        }
        if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      // sw.js?v=... lagane se browser hamesha nayi SW file fetch karega
      navigator.serviceWorker.register('/sw.js?v=' + Date.now()).then(reg => {
        
        // Agar naya worker milta hai
        reg.onupdatefound = () => {
          const newWorker = reg.installing;
          newWorker.onstatechange = () => {
            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
              // Jaise hi naya version download hoga, page apne aap refresh ho jayega
              window.location.reload();
            }
          };
        };

      }).catch(err => console.log("Service Worker Error:", err));
    });
  }
    </script>
</body>
</html>
